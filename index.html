<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>On-call Scheduler</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2c3e50; }
    label, select, input, button { margin: 8px 0; display: block; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; max-width: 500px; }
    th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; }
    th { background: #f4f4f4; }
  </style>
</head>
<body>
  <h1>On-call Scheduler</h1>

  <!-- Form Section -->
  <form id="oncall-form">
    <label for="person">Select person:</label>
    <select id="person" name="person">
      <option value="Alice">Alice</option>
      <option value="Bob">Bob</option>
      <option value="Charlie">Charlie</option>
      <option value="Diana">Diana</option>
      <option value="Edward">Edward</option>
      <option value="Frank">Frank</option>
    </select>

    <label for="date">Select date:</label>
    <input type="date" id="date" name="date">

    <button type="button" id="add-button">Add On-call</button>
  </form>

  <!-- Schedule Table -->
  <h2>Schedule</h2>
  <table>
    <thead>
      <tr><th>Date</th><th>Person</th></tr>
    </thead>
    <tbody id="schedule"></tbody>
  </table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwqCTIHGCM3XvZeVuL-knhKy8vUbZ-O8pC33YRtLCmVaXmYTYI2TIynCWFuK99w_J0A/exec"; // replace with your Apps Script URL

    // Load schedule from Google Sheets
    async function loadSchedule() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        const tbody = document.getElementById('schedule');
        tbody.innerHTML = "";
        data.sort((a,b) => a.date.localeCompare(b.date)).forEach(r => {
          const row = document.createElement('tr');
          row.innerHTML = `<td>${r.date}</td><td>${r.person}</td>`;
          tbody.appendChild(row);
        });
      } catch(err) {
        console.error("Error loading schedule:", err);
      }
    }

    // Add on-call assignment
    async function addOncall() {
      const person = document.getElementById('person').value;
      const date = document.getElementById('date').value;

      if (!date) {
        alert("Select a date");
        return;
      }

      try {
        await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ person, date })
        });

        document.getElementById('date').value = "";
        loadSchedule();
      } catch(err) {
        alert("Error saving assignment");
        console.error(err);
      }
    }

    // Hook up button
    document.getElementById('add-button').addEventListener('click', addOncall);

    // Load schedule when page loads
    window.onload = loadSchedule;
  </script>
</body>
</html>
